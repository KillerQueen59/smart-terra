generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id    String  @id @default(uuid())
  email String  @unique
  name  String?
  role  String?
}

model PT {
  id         String          @id @default(uuid())
  name       String
  kebuns     Kebun[]
  alatAWS    AlatAWS[]
  alatAWL    AlatAWL[]
  dashboards AlatDashboard[]
}

model Kebun {
  id          String          @id @default(uuid())
  name        String
  ptId        String
  pt          PT              @relation(fields: [ptId], references: [id])
  alatAWS     AlatAWS[]
  alatAWL     AlatAWL[]
  dashboards  AlatDashboard[]
  weatherData WeatherData[]
  tmasData    TMASData[]
  tmatData    TMATData[]
}

model AlatAWS {
  id          String        @id @default(uuid())
  name        String
  detailName  String
  startDate   String
  battery     Int
  signal      Int
  sensor      Int
  status      String
  latitude    Float? // Added latitude field
  longitude   Float? // Added longitude field
  ptId        String
  kebunId     String
  pt          PT            @relation(fields: [ptId], references: [id])
  kebun       Kebun         @relation(fields: [kebunId], references: [id])
  weatherData WeatherData[]
}

model AlatAWL {
  id         String     @id @default(uuid())
  name       String
  detailName String
  startDate  String
  battery    Int
  signal     Int
  data       Int
  status     String
  type       String // "TMAS" for water surface data, "TMAT" for water table data
  note       String
  latitude   Float? // Added latitude field
  longitude  Float? // Added longitude field
  ptId       String
  kebunId    String
  pt         PT         @relation(fields: [ptId], references: [id])
  kebun      Kebun      @relation(fields: [kebunId], references: [id])
  tmasData   TMASData[]
  tmatData   TMATData[]
}

model AlatDashboard {
  id         String @id @default(uuid())
  ptId       String
  kebunId    String
  deviceType String // "AWS", "TMAS", or "TMAT" (TMAS and TMAT are AWL device types)
  rusak      Int
  idle       Int
  active     Int
  alert      Int
  pt         PT     @relation(fields: [ptId], references: [id])
  kebun      Kebun  @relation(fields: [kebunId], references: [id])

  @@unique([ptId, kebunId, deviceType])
}

model WeatherData {
  id                Int      @id @default(autoincrement())
  tanggal           DateTime
  year              Int
  suhuRataRata      Float
  ch                Float
  kelembabanRelatif Float
  tekananUdara      Float
  windSpeed         Float
  windDirec         Float
  suhuMinimal       Float
  suhuMaksimal      Float
  evapotranspirasi  Float
  radiasiSolarPanel Float
  kebunId           String
  awsId             String
  kebun             Kebun    @relation(fields: [kebunId], references: [id])
  alatAWS           AlatAWS  @relation(fields: [awsId], references: [id])
  createdAt         DateTime @default(now())
}

model TMASData {
  id         Int      @id @default(autoincrement())
  tanggal    DateTime
  ketinggian Float
  kebunId    String
  awlId      String
  kebun      Kebun    @relation(fields: [kebunId], references: [id])
  alatAWL    AlatAWL  @relation(fields: [awlId], references: [id])
  createdAt  DateTime @default(now())
}

model TMATData {
  id         Int      @id @default(autoincrement())
  tanggal    DateTime
  ketinggian Float // Water table level as percentage
  kebunId    String
  awlId      String // Back to awlId since TMAT is handled by AWL devices
  kebun      Kebun    @relation(fields: [kebunId], references: [id])
  alatAWL    AlatAWL  @relation(fields: [awlId], references: [id]) // Back to alatAWL
  createdAt  DateTime @default(now())
}
